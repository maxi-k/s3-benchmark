#!/bin/bash

# go the ec2-user home dir
cd /home/ec2-user

# download the test program
ARCH=$(arch)
if [ $ARCH = "aarch64" ]; then
  binvar=linux-arm64
else
  binvar=linux-amd64
fi
curl -o s3-benchmark \
     https://github.com/maxi-k/s3-benchmark/raw/fit-to-usecase/build/$binvar/s3-benchmark

# make it executable
chmod +x s3-benchmark

# run the exhaustive test 1 KB to 16 MB, and 1 to 48 threads; upload the csv results to S3
prefix=csv-$(date -Idate)
./s3-benchmark -upload-csv=$prefix

# shutdown to terminate the instance after the test is complete
shutdown
